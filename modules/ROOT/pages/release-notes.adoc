= Release Notes

== 2.1

*Deprecations*

The following features are being deprecated and will be unsupported in an upcoming version of Sync Gateway.

* *Bucket shadowing* has been deprecated since 1.4 and has now become unsupported.
The recommended approach to perform operations on a bucket dedicated to Couchbase Mobile is to enable link:shared-bucket-access.html[shared bucket access].

*Performance Improvements*

- https://github.com/couchbase/sync_gateway/issues/716[*#716*] Use sync.atomic to synchronize logging logLevel
- https://github.com/couchbase/sync_gateway/issues/2396[*#2396*] SyncGateway restart after node automatic failover is taking more time
- https://github.com/couchbase/sync_gateway/issues/2536[*#2536*] SG-Replicator throughput is not increasing with SG-Accelerator
- https://github.com/couchbase/sync_gateway/issues/2563[*#2563*] Allow callers to provide current value to WriteUpdateWithXattr

*Enhancements*

- https://github.com/couchbase/sync_gateway/issues/145[*#145*] Switch from base/logging.go to 'clog' package
- https://github.com/couchbase/sync_gateway/issues/341[*#341*] Sync_Gateway config file only supports one URL in connection string
- https://github.com/couchbase/sync_gateway/issues/716[*#716*] Use sync.atomic to synchronize logging logLevel
- https://github.com/couchbase/sync_gateway/issues/939[*#939*] Use W3C log format for HTTP logging
- https://github.com/couchbase/sync_gateway/issues/1021[*#1021*] Enable log level to be set via SG config
- https://github.com/couchbase/sync_gateway/issues/1652[*#1652*] Differentiate logging between standard out and standard error
- https://github.com/couchbase/sync_gateway/issues/1964[*#1964*] Add DCP support to Walrus w/ rollback ability
- https://github.com/couchbase/sync_gateway/issues/3119[*#3119*] Avoid design doc/view creation when already present
- https://github.com/couchbase/sync_gateway/issues/3526[*#3526*] 2.1.0- sg collect info - Show message if sync gateway is not running
- https://github.com/couchbase/sync_gateway/issues/3584[*#3584*] Sync-gateway does not show any error on logs when used wrong name/value pairs for logging

*Bugs*

- https://github.com/couchbase/sync_gateway/issues/1574[*#1574*] Windows installer does not start and stop service wrapper
- https://github.com/couchbase/sync_gateway/issues/2173[*#2173*] Go-couchbase 500 errors when rebalancing
- https://github.com/couchbase/sync_gateway/issues/3548[*#3548*] Windows logs are written to "Program Files (x86)" when running from "Program Files"
- https://github.com/couchbase/sync_gateway/issues/3549[*#3549*] Incompatible Windows filename from _sgcollect_info endpoint
- https://github.com/couchbase/sync_gateway/issues/3555[*#3555*] _sgcollect_info endpoint fails with 500 error on build 78
- https://github.com/couchbase/sync_gateway/issues/3559[*#3559*] Output_directory parameter is ignored on sg_collectinfo rest end point
- https://github.com/couchbase/sync_gateway/issues/3561[*#3561*] Uploadhost is ignored when upload parameter is not given to _sgcollect_info end point
- https://github.com/couchbase/sync_gateway/issues/3572[*#3572*] _sg_collect_info rest end point : Throwing bad request error for a requirement for upload host with upload enabled to false
- https://github.com/couchbase/sync_gateway/issues/3583[*#3583*] Sgcollect : No sgcollect info zip for sg accel
- https://github.com/couchbase/sync_gateway/issues/3632[*#3632*] Sgcollect rest api fails with no write access to "/opt/couchbase-sync-gateway/tools"
- https://github.com/couchbase/sync_gateway/issues/3655[*#3655*] Sg collect rest API does not create zip files under /home/sync-gateway

*Known Issues*

- https://github.com/couchbase/sync_gateway/issues/3562[*#3562*] Sync Gateway requires Couchbase Server nodes to use the same SSL memcached port

== Upgrading

The upgrade from views to GSI (N1QL) happens automatically when starting a Sync Gateway 2.1 node in a cluster that was previously using views.

Installation will follow the same approach implemented in 2.0 for view changes.
On startup, Sync Gateway will check for the existence of the GSI indexes, and only attempt to create them if they do not already exist.
As part of the existence check, Sync Gateway will also check if link:config-properties.html#databases-foo_db-num_index_replicas[databases.$db.num_index_replicas] for the existing indexes matches the value specified in the configuration file.
If not, Sync Gateway will drop and recreate the index.
Then, Sync Gateway will wait until indexes are available before starting to serve requests.

Sync Gateway 2.1 will *not* automatically remove the previously used design documents.
Removal of the obsolete design documents is done via a call to the new link:admin-rest-api.html#/server/post__post_upgrade[+/{db}/_post_upgrade+] endpoint in Sync Gateway`'s Admin REST API.
This endpoint can be run in preview mode (`?preview=true`) to see which design documents would be removed.
To summarize, the steps to perform an upgrade to Sync Gateway 2.1 are:

. Upgrade one node in the cluster to 2.1, and wait for it to be reachable via the REST API (for example at \http://localhost:4985/).
. Upgrade the rest of the nodes in the cluster.
. Clean up obsolete views:
** *Optional* Issue a call to `/_post_upgrade?preview=true` on any node to preview which design documents will be removed. To upgrade to 2.1, expect to see "sync_gateway" and "sync_housekeeping" listed.
** Issue a call to `/post_upgrade` to remove the obsolete design documents. The response should indicate that "sync_gateway" and "sync_housekeeping" were removed.
