= Release Notes
:page-aliases: prodnotes/pn-releasenotes.adoc, prodnotes/pn-release-notes.adoc, releasenotes.adoc, pn-release-notes.adoc
:page-edition: {release}
:page-status: {prerelease}
:page-role:
:description: Couchbase Sync Gateway
:keywords: edge nosql api synchronization replication
// End of Page Attribute Statements

include::partial$_std-hdr-sgw.adoc[]

:ns-this: {ns} for this release
:fn-icr: footnote:icr[As of Sync Gateway version 2.8]
// :this-release: {version-full}

:docpath: sync-gateway::release-notes.adoc
Quicklinks to previous release notes:
xref:2.8@{docpath}[Release 2.8] |
xref:2.7@{docpath}[Release 2.7] |
xref:2.6@{docpath}[Release 2.6] |
xref:2.5@{docpath}[Release 2.5] |
xref:2.1@{docpath}[Release 2.1] |
xref:2.0@{docpath}[Release 2.0]

:docpath!:

// DO NOT EDIT -- Header Content Block
:param-abstract: This content describes the key features and changes implemented by release {version-full} of Couchbase Sync{nbsp}Gateway
:param-related: {whatsnew--xref}  |  {compatibility--xref} | {supported-environments--xref}
include::partial$block-abstract.adoc[]
// DO NOT EDIT -- Header Content Block


:xref-sgw-bmk-cfg-dbsvr: xref:{configuration-properties--page}#databases-this_db-server[Couchbase Server Connection String]
:xref-sgw-bmk-cfg-hideprodvn: xref:{configuration-properties--page}#hide_product_version[Hide Product Version in Headers]

// END DO NOT REMOVE

.One Way Upgrade
[CAUTION]
--
The migration to 3.0 BETA configuration is a ONE WAY process -- see: {upgrading--xref} for more.
--


[#lbl-rel300]
== Release {version-full} -- September 2021
Quicklinks: <<new-features-300>> *|*
<<improvements-300>> *|*
<<issues-and-resolutions-300>> *|*
<<support-notices-300>>


[#new-features-300]
== New Feature Highlights

=== Centralized Persistent Modular Configuration
include::partial$common-releasenotes.adoc[tag="new-300-centralized-cfg-summ", leveloffset=+1]

xref:whatsnew.adoc#centralized-persistent-modular-configuration[Read More ...]


=== Secure Administration

include::partial$common-releasenotes.adoc[tag="new-300-secure-admin-summ", leveloffset=+1]

xref:whatsnew.adoc#secure-administration[Read More ...]


=== TLS Encryption Enabled by Default

include::partial$common-releasenotes.adoc[tag="new-300-tls-summ", leveloffset=+1]

xref:whatsnew.adoc#tls-encryption-enabled-by-default[Read More ...]


=== User Defined Extended Attributes(XAttrs) for Access Control

include::partial$common-releasenotes.adoc[tag="new-300-xattrs-summ", leveloffset=+1]

xref:whatsnew.adoc#user-defined-extended-attributesxattrs-for-access-control[Read More ...]


=== Auto-Purge on Channel Access Revocation in Inter-Sync Gateway Replication

include::partial$common-releasenotes.adoc[tag="new-300-auto-purge-summ", leveloffset=+1]

xref:whatsnew.adoc#auto-purge-on-channel-access-revocation-in-inter-sync-gateway-replication[Read More ...]


=== Use Environment Variables in Configuration File

include::partial$common-releasenotes.adoc[tag="new-300-environment-vars-summ", leveloffset=+1]

xref:whatsnew.adoc#use-environment-variables-in-configuration-file[Read More ...]


[#improvements-300]
== Other Enhancements
// tag::enhancements-300[]

// tag::Enhancements-3-0-0-beta[]

* https://issues.couchbase.com//browse/CBG-1705[CBG-1705] -- https://issues.couchbase.com//browse/CBG-1705[Release 'view op' on results close]
* https://issues.couchbase.com//browse/CBG-1679[CBG-1679] -- https://issues.couchbase.com//browse/CBG-1679[Apply standardised timeout and retry for all bootstrap connection ops]
* https://issues.couchbase.com//browse/CBG-1672[CBG-1672] -- https://issues.couchbase.com//browse/CBG-1672[Return 422 status for unprocessible deltas instead of 404 to use non-delta retry handling]
* https://issues.couchbase.com//browse/CBG-1664[CBG-1664] -- https://issues.couchbase.com//browse/CBG-1664[Validate javascript syntax in DbConfig.validate()]
* https://issues.couchbase.com//browse/CBG-1659[CBG-1659] -- https://issues.couchbase.com//browse/CBG-1659[SGCollect - Ensure it works / change for admin auth]
* https://issues.couchbase.com//browse/CBG-1650[CBG-1650] -- https://issues.couchbase.com//browse/CBG-1650[sgcollect should get information from new endpoints (with include_runtime parameter, etc.)]
* https://issues.couchbase.com//browse/CBG-1646[CBG-1646] -- https://issues.couchbase.com//browse/CBG-1646[Add a flag to non-active leaf revisions indicating whether they include v2 attachments]
* https://issues.couchbase.com//browse/CBG-1643[CBG-1643] -- https://issues.couchbase.com//browse/CBG-1643[Add additional context for gocb errors when using self-signed cert]
* https://issues.couchbase.com//browse/CBG-1642[CBG-1642] -- https://issues.couchbase.com//browse/CBG-1642[Detect legacy sg-replicate config and log accordingly]
* https://issues.couchbase.com//browse/CBG-1635[CBG-1635] -- https://issues.couchbase.com//browse/CBG-1635[TestBucketPool V2 should close cluster when releasing/obtaining buckets]
* https://issues.couchbase.com//browse/CBG-1590[CBG-1590] -- https://issues.couchbase.com//browse/CBG-1590[Retrieve existing doc metadata prior to calling downloadOrVerifyAttachments]
* https://issues.couchbase.com//browse/CBG-1473[CBG-1473] -- https://issues.couchbase.com//browse/CBG-1473[Enable log redaction by default]
* https://issues.couchbase.com//browse/CBG-1424[CBG-1424] -- https://issues.couchbase.com//browse/CBG-1424[discoverInterfaceName should resolve hostnames before trying to find network interface stats using IP addresses]
* https://issues.couchbase.com//browse/CBG-1391[CBG-1391] -- https://issues.couchbase.com//browse/CBG-1391[Treat existing cbgt index as recoverable error]
* https://issues.couchbase.com//browse/CBG-1390[CBG-1390] -- https://issues.couchbase.com//browse/CBG-1390[Add warning threshold for excessively large number of channels per user]
* https://issues.couchbase.com//browse/CBG-1359[CBG-1359] -- https://issues.couchbase.com//browse/CBG-1359[Increase default minimum TLS version TLS1.2]
* https://issues.couchbase.com//browse/CBG-1343[CBG-1343] -- https://issues.couchbase.com//browse/CBG-1343[Increase initial wait time for index creation retry]
* https://issues.couchbase.com//browse/CBG-1342[CBG-1342] -- https://issues.couchbase.com//browse/CBG-1342[Avoid retry on 'duplicate index name' index creation error]
* https://issues.couchbase.com//browse/CBG-1337[CBG-1337] -- https://issues.couchbase.com//browse/CBG-1337[Add an option to skip SSL certificates verification while loading JavaScript from HTTPS endpoints]
* https://issues.couchbase.com//browse/CBG-1326[CBG-1326] -- https://issues.couchbase.com//browse/CBG-1326[Log if channels expand to a smaller set than requested]
* https://issues.couchbase.com//browse/CBG-1299[CBG-1299] -- https://issues.couchbase.com//browse/CBG-1299[[Lithium Port] - Implement network connstr flag for cbdatasource alt address shims]
* https://issues.couchbase.com//browse/CBG-1282[CBG-1282] -- https://issues.couchbase.com//browse/CBG-1282[XATTRS Access Grants]
* https://issues.couchbase.com//browse/CBG-1280[CBG-1280] -- https://issues.couchbase.com//browse/CBG-1280[Channel Access Revocation]
* https://issues.couchbase.com//browse/CBG-1273[CBG-1273] -- https://issues.couchbase.com//browse/CBG-1273[Add Prometheus alert examples]
* https://issues.couchbase.com//browse/CBG-1253[CBG-1253] -- https://issues.couchbase.com//browse/CBG-1253[Add USE INDEX to index readiness queries]
* https://issues.couchbase.com//browse/CBG-1251[CBG-1251] -- https://issues.couchbase.com//browse/CBG-1251[Support Apple (M1) Silicon]
* https://issues.couchbase.com//browse/CBG-1245[CBG-1245] -- https://issues.couchbase.com//browse/CBG-1245[Include channel name in validfrom logging]
* https://issues.couchbase.com//browse/CBG-1240[CBG-1240] -- https://issues.couchbase.com//browse/CBG-1240[Remove couchbase/ns_server dependency]
* https://issues.couchbase.com//browse/CBG-1239[CBG-1239] -- https://issues.couchbase.com//browse/CBG-1239[Remove couchbase/retriever dependency]
* https://issues.couchbase.com//browse/CBG-1232[CBG-1232] -- https://issues.couchbase.com//browse/CBG-1232[Add support for loading webhook filter JavaScript from external file or URL]
* https://issues.couchbase.com//browse/CBG-1217[CBG-1217] -- https://issues.couchbase.com//browse/CBG-1217[Ensure change listener goroutines terminates (both Tap and DCP feeds) before the server is stopped]
* https://issues.couchbase.com//browse/CBG-1170[CBG-1170] -- https://issues.couchbase.com//browse/CBG-1170[Upgrade to go 1.15]
* https://issues.couchbase.com//browse/CBG-1127[CBG-1127] -- https://issues.couchbase.com//browse/CBG-1127[Treat resurrected tombstones as non-conflict when no shared history]
* https://issues.couchbase.com//browse/CBG-949[CBG-949] -- https://issues.couchbase.com//browse/CBG-949[Improve error when non-upgradable HTTP request is sent to _blipsync endpoint]
* https://issues.couchbase.com//browse/CBG-841[CBG-841] -- https://issues.couchbase.com//browse/CBG-841[Force users to opt in to accepting unsigned tokens from providers in SG's provider config.]
* https://issues.couchbase.com//browse/CBG-715[CBG-715] -- https://issues.couchbase.com//browse/CBG-715[High CPU usage in high volume basic auth scenarios]
* https://issues.couchbase.com//browse/CBG-641[CBG-641] -- https://issues.couchbase.com//browse/CBG-641[Admin API Auth]
* https://issues.couchbase.com//browse/CBG-551[CBG-551] -- https://issues.couchbase.com//browse/CBG-551[Avoid storing _removed:true revision bodies in the revision cache]
// end::Enhancements-3-0-0-beta[]
// end::enhancements-300[]

[#issues-and-resolutions-300]
== Issues and Resolutions

=== Known Issues

// tag::known-300[]
// .List of issues outstanding at this release
* https://issues.couchbase.com//browse/CBG-798[CBG-798] -- https://issues.couchbase.com//browse/CBG-798[Sync Gateway requires Couchbase Server nodes to use the same SSL memcached port]


// end::known-300[]

== Fixed Issues
// tag::fixed-300[]
// tag::Fixed-3-0-0-beta[]

* https://issues.couchbase.com//browse/CBG-1438[CBG-1438] -- https://issues.couchbase.com//browse/CBG-1438[SgwIntStat.SetIfMax incorrectly sums old and new values]
* https://issues.couchbase.com//browse/CBG-1412[CBG-1412] -- https://issues.couchbase.com//browse/CBG-1412[JSON strings in some responses not being correctly escaped]
* https://issues.couchbase.com//browse/CBG-1388[CBG-1388] -- https://issues.couchbase.com//browse/CBG-1388[sg_collect does not package archived log files (*.log.gz)]
* https://issues.couchbase.com//browse/CBG-1376[CBG-1376] -- https://issues.couchbase.com//browse/CBG-1376[Some Delta Sync errors logged at WARN level should be DEBUG]
* https://issues.couchbase.com//browse/CBG-1339[CBG-1339] -- https://issues.couchbase.com//browse/CBG-1339[Creating mobile tombstone for existing CBS tombstone causes loop]
* https://issues.couchbase.com//browse/CBG-1335[CBG-1335] -- https://issues.couchbase.com//browse/CBG-1335[Mutating _rev on localDocument in conflict resolver results in merge error]
* https://issues.couchbase.com//browse/CBG-1325[CBG-1325] -- https://issues.couchbase.com//browse/CBG-1325[Incorrect email validation (too strict)]
* https://issues.couchbase.com//browse/CBG-1304[CBG-1304] -- https://issues.couchbase.com//browse/CBG-1304[ISGR: Pull replications incompatible with active-side allow_conflicts=false]
* https://issues.couchbase.com//browse/CBG-1246[CBG-1246] -- https://issues.couchbase.com//browse/CBG-1246[Changes limit incorrectly applied in case of CBG-946]
* https://issues.couchbase.com//browse/CBG-1231[CBG-1231] -- https://issues.couchbase.com//browse/CBG-1231[Prevent import cfg startup races]
* https://issues.couchbase.com//browse/CBG-1200[CBG-1200] -- https://issues.couchbase.com//browse/CBG-1200[Calling DELETE on a non-existent document creates a tombstone with empty body]
* https://issues.couchbase.com//browse/CBG-1172[CBG-1172] -- https://issues.couchbase.com//browse/CBG-1172[ISGR credentials with characters requiring URL encoding cause blipsync to fail]
* https://issues.couchbase.com//browse/CBG-1161[CBG-1161] -- https://issues.couchbase.com//browse/CBG-1161[DefaultPurgeInterval specified in days and used as though in hours]
* https://issues.couchbase.com//browse/CBG-1113[CBG-1113] -- https://issues.couchbase.com//browse/CBG-1113[CBL1.x/Websocket based changes feeds leak goroutine on disconnect]
* https://issues.couchbase.com//browse/CBG-789[CBG-789] -- https://issues.couchbase.com//browse/CBG-789[Updating a blob with new data does not update SG's metadata on sync]

// end::Fixed-3-0-0-beta[]
// end::fixed-300[]

// tag::api-changed-300[]
// tbd
// end::api-changed-300[]

// tag::cfg-changed-300[]
// tbd
// end::cfg-changed-300[]

== Breaking Changes
// â€“ identify any REST API changes
// tag::api-changes-300[]
// tag::all-changed-300-api[]
This release introduces significant configuration and persistent API changes; some of which may be breaking changes if they impact a feature you rely on -- see the items identified in <<tbl-breaking>> | <<tbl-deprecated>> | <<tbl-dropped>>.

=== Breaks compatibility

.Breaks compatibility
[#tbl-breaking, cols="1a,1a", options="header"]
|===
.>|  Feature
.>|   Link

// |  Cannot start sync gateway in CLI without providing either a configuration file or a CLI flag
// |

|  enable_shared_bucket_access -- enabled by default

The change _ought to be_ transparent to the user, *if*:

* Doc metadata is smaller than 1MB
* There is no reliance on inspecting doc metadata using the `_sync` property in a document on the server side

Old documents are automatically migrated to the `xattr` metadata format.

|   xref:2.8@sync-gateway:ROOT:configuration-properties.adoc#databases-this_db-enable_shared_bucket_access[enable_shared_bucket_access]

|  Enforce TLS by default
|  xref:secure-sgw-access.html#lbl-cbs-comms[Couchbase Server Connection]

|===

=== Deprecated

.Deprecated
[#tbl-deprecated, cols="1a,1a", options="header"]
|===
.>|  Feature
.>|   Link

|  allow_conflicts confg
|   xref:2.8@sync-gateway:ROOT:configuration-properties.adoc#databases-this_db-allow_conflicts[allow_conflicts]

|  enable_shared_bucket_access -- disabled option
|

|  Facebook User Auth Config
|   xref:2.8@sync-gateway:ROOT:configuration-properties.adoc#facebook[facebook]

|  Google User Auth Config
|   xref:2.8@sync-gateway:ROOT:configuration-properties.adoc#facebook[Google]

|  Logging API
|
|   Deprecated
|===

=== Dropped or removed
.Dropped or removed
[#tbl-dropped, cols="1a,1a", options="header"]
|===
.>|  Feature
.>|   Link

|  admin UI
|

|  configServer property
|   xref:2.8@sync-gateway:ROOT:configuration-properties.adoc#configServer[configserver]

|  databases.this_db.cache.channel_cache_expiry
|   xref:2.8@sync-gateway:ROOT:configuration-properties.adoc#databases-this_db-cache-channel_cache_expiry[channel_cache_expiry]

|  databases.this_db.feed_type
|   xref:2.8@sync-gateway:ROOT:configuration-properties.adoc#databases-this_db-feed_type[feed_type]

|  logging.default config section
|   xref:legacy-logging-pre2-1.adoc[Legacy - Pre-2.1 Logging]

|  old cache config values :databases.this_db.cache.channel_cache_max_length
|   xref:2.8@sync-gateway:ROOT:configuration-properties.adoc#databases-this_db-cache-channel_cache_max_length[channel_cache_max_length]

|  old cache config values :databases.this_db.cache.channel_cache_min_length
|   xref:2.8@sync-gateway:ROOT:configuration-properties.adoc#databases-this_db-cache-channel_cache_min_length[channel_cache_min_length]

|  old cache config values :databases.this_db.cache.enable_star_channel
|   xref:2.8@sync-gateway:ROOT:configuration-properties.adoc#databases-this_db-cache-enable_star_channel[enable_star_channel]

|  old cache config values :databases.this_db.cache.max_num_pending
|   xref:2.8@sync-gateway:ROOT:configuration-properties.adoc#databases-this_db-cache-max_num_pending[max_num_pending]

|  old cache config values :databases.this_db.cache.max_wait_pending
|   xref:2.8@sync-gateway:ROOT:configuration-properties.adoc#databases-this_db-cache-max_wait_pending[db-cache-max_wait_pending]

|  old cache config values :databases.this_db.cache.max_wait_skipped
|   xref:2.8@sync-gateway:ROOT:configuration-properties.adoc#databases-this_db-cache-max_wait_skipped[max_num_skipped]

|  old cache config values: databases.this_db.rev_cache_size
|   xref:2.8@sync-gateway:ROOT:configuration-properties.adoc#databases-this_db-rev_cache_size[rev_cache_size]

|  SG-Replicate
|   xref:2.8@sync-gateway:ROOT:legacy-sg-replicate.adoc[Legacy -- SG-Replicate]

|  walrus (should not be default database mode)
|   xref:2.8@sync-gateway:ROOT:configuration-properties.adoc#databases-this_db-server[server]
|   Dropped
|===


// end::all-changed-300-api[]

// end::api-changes-300[]

[#support-notices-300]
== Support Notices
This section documents any support-related notes, constraints and changes

=== Deprecation Notices
Items (features and-or functionality) are marked as deprecated when a more current, and usually enhanced, alternative is available.

Whilst the deprecated item will remain usable, it is no longer supported, and will be removed in a future release.
You should plan to move to an alternative, supported, solution as soon as practical.

// tag::deprecated-300[]
// tag::dnsgw-30[] all deprecations for the release
// // tag::dnsgw-30-001-note[]
// // tag::dnsgw-30-001-notetitle[]
// =====  note title
// // tag::dnsgw-30-001-noteannounce[]

// // end::dnsgw-30-001-noteannounce[]

// tag::dnsgw-30-001-noteimpact[]
// The functionality of SG{nbsp}Replicate remains unchanged, unless explicitly stated in these release notes and-or in the appropriate documentation section.
// Refer to {xref-sgw-pg-upgrade} for more information on upgrading from SG Replicate to Inter-Sync Gateway replication.
// end::dnsgw-30-001-noteimpact[]
// end::dnsgw-30-001-note[]

// ==== Configuration deprecations
// // tag::dnsgw-30-001-cfg[]

// // tag::dnsgw-30-001-cfg1[]
// // end::dnsgw-30-001-cfg1[]

// // end::dnsgw-30-001-cfg[]

// ===== REST API Deprecations
// // tag::dnsgw-30-001-api[]

// // tag::dnsgw-30-001-api1[]
// // end::dnsgw-30-001-api1[]

// // end::dnsgw-30-001-api[]

// ===== Operating Systems
// Support for Microsoft Windows 2012 (64-bit) is deprecated

// end::dnsgw-30[]
// end::deprecated-300[]
// ===== Ongoing
// include::partial$block-deprecations.adoc[tag=any-platform-ongoing]
// include::partial$block-deprecations.adoc[tag={param-platform}-ongoing]

// === End of Life
// include::partial$block-deprecations.adoc[tag=any-platform-eol]
// include::partial$block-deprecations.adoc[tag={param-platform}-eol]

// === End of Support
// {ns-this}

// ==== Other Notices

// ===== Support is added for:


=== Upgrading

// tag::upgrading[]

// end::upgrading[]

For more on upgrading -- see: {upgrading--xref}


// DO NOT EDIT -- Footer Related Content Block
include::partial$block-related-content-product.adoc[]
// DO NOT EDIT -- Footer Related Content Block


// END -- PAGE -- modules/ROOT/pages/release-notes.adoc