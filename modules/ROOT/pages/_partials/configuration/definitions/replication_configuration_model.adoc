
[[_replication_configuration_model]]
=== replication_configuration_model


// tag::content[]

This replication request message body is a JSON document that comprises all the properties required to upsert a replication.

If the `replicationID` matches an existing `replication_id` then the values of any properties provided in the body are used to update the existing replication's property values.


[options="header", cols=".^3a,.^11a,.^4a"]
|===
|Name|Description|Schema
|**replication_id** +
__optional__|*About*

The _replication_id_ property specifies either:
- For NEW replications, the ID to be assigned to the the replication. If no _replication_id_ is specified, Sync Gateway will assign a random UUID to new replications.
- For existing replications, this is the ID of the required replication.
- If *cancel=true*, this is the id of the active replication task to be cancelled.

*Constraints*

If this is specified in the body of a POST or PUT request then it must be the same value as specified in the request URL.|string
|**remote** +
__optional__|*About*

The *remote* property represents the endpoint of s database for the remote Sync Gateway.
That is, it identifies the remote Sync Gateway database that is the subject of this replication's push, pull or pushAndPull action.

Typically the endpoint will include URI, Port and Database name elements.

*Format*

* a string containing a valid URL for a (remote) Sync Gateway database.
* an object whose url property contains the Sync Gateway database URL.

*Behavior*

Dependent upon setting of *direction*.

If *direction* is :
 - _pull_, 'remote' defines the remote cluster _from_ which data is pulled
 - _push_, 'remote' defines the remote cluster _to_ which data is pushed
 - _pushAndPull_, 'remote' defines the _push_ configuration.

*Example*

[source,json]
----
"remote": "http://www.example.com:4984/sample-database",
----|string
|**username** +
__optional__|*About*

Use `username` to provide the name of the accredited user running this replication.

*Behavior*

These details are used to authenticate credentials and approve access to data

Once provided and recorded, the username data is redacted and will not be displayed in either the configuration file or Admin REST API. A string of `****` will be displayed in its place. +
**Default** : `"Mandatory"`|string
|**password** +
__optional__|*About*

Use `password` to provide the login password value for the accredited user running this replication.

*Behavior*

These details are used to authenticate credentials and approve access to data.

Once provided and recorded, the password data is redacted and will not be displayed in either the configuration file or Admin REST API. A string of `****` will be displayed in its place. +
**Default** : `"mandatory"`|string
|**direction** +
__optional__|*About*

The mandatory `direction` property specifies whether the replication is _push_, _pull_ or _pushAndPull_ relative to this node.

The property value is referenced by the link:rest-api-admin.html#database-this_db-replications-remote[remote] property.

*Behavior*

* `pull` – changes are pulled from the `remote` database
* `push` – changes are pushed to the `remote` database
* `pushAndPull` – changes are both pushed-to and pulled-from the `remote` database

*Constraints*

Replications created prior to version 2.8 derive their _direction_ from the source/target url of the replication.|string
|**conflict_resolution_type** +
__optional__|*About*

The *`conflict_resolution_type`* property defines the conflict resolution policy that Sync Gateway applies when resolving conflicting revisions.

The default behavior is that automatic conflict resolution policy is applied.

*Valid options*
 - `default`
 - `localWins`
 - `remoteWins`
 - `custom`

*Behavior*

* _default_ – Selecting `default` applies the following conflict resolution policy
* Deletes always win (the delete with longest revision history wins if both revisions are deletes)
* The revision with the longest revision history wins (so, the one with most changes and consequently the highest revision Id).
* _localWins_ – Selecting `localWins` will result in local revisions always being the winner in any conflict.

* _remoteWins_ – Selecting `remoteWins` will result in remote revisions always being the winner in any conflict.
* _custom_ – Selecting `custom` specifies that you want to handle conflict resolution with your own application logic. You *must* provide this logic as a Javascript function by specifying it in using the custom-conflict-resolver parameter.

*Example*

----
"conflict_resolution_type":"remoteWins"
----

*Constraints*

* replications created prior to version 2.8 will default to `default`. +
**Default** : `"default"`|string
|**custom_conflict_resolver** +
__optional__|*About*

The optional `custom_conflict_resolver` property specifies the Javascript function that will be used to resolve conflicts, if the custom conflict resolution type is specified in the `conflict_resolution_type`.

*Options*

The property is _mandatory_ when `conflict_resolution_type=custom` and will be ignored in all other cases.

*Using*

Provide the required logic in a Javascript function, as a string within backticks (see also the description for the `sync` function`.

The function takes one parameter `struct` representing the conflict and comprising
- the document id
- the local document
- the remote document

The function returns a document `struct` representing the winning revision.

*Example*

----
"custom_conflict_resolver":`
  function(conflict) {
    console.log("full remoteDoc doc: "+JSON.stringify(conflict.RemoteDocument));
  return conflict.RemoteDocument;
}`
----

*Constraints*

Using complex `custom_conflict_resolver` functions can noticeably degrade performance. Use a built-in resolver whenever possible. +
**Default** : `"none"`|string
|[#purge-on-removal]**purge_on_removal** +
__optional__|*About*

The optional `purge_on_removal` property specifies, per replication, whether the removal of a `channel` triggers a purge.

*Options*
- `true` or `false`
- Default = false – document removals are ignored by receiving end

*Behavior*

If `purge_on_removal=false`, then the removal of channels is ignored (not purged) by the receiving end.

*Constraints*

Replications created prior to version 2.8 _must_ be run with `purge_on_removal=false`. +
**Default** : `false`|boolean
|**enable_delta_sync** +
__optional__|*About*

The optional `enable_delta_sync` parameter turns on delta sync for a replication.
It works in conjunction with the database level setting `delta_sync.enabled`.

*Options*

* `&quot;enable_delta_sync&quot;: true`, the replication can use delta sync (depending on `delta_sync.enabled` setting)
* `&quot;enable_delta_sync&quot;: false`, the replication cannot use delta sync

*Behavior*

The optional `enable_delta_sync` parameter works in conjunction with the database level `delta_sync.enabled` setting, to determine whether this replication uses delta sync.

* *If* `&quot;delta_sync.enabled&quot;: true` for both databases involved in the replication, then this parameter enables or disables its use for this specific replication.
* In all other cases it has no effect and the replication runs without delta-sync.

*Constraints*

* Applies *ONLY* to Enterprise Edition deployments.
* Depends upon the setting of the database level parameter `delta_sync.enabled`
* Replications created prior to version 2.8 must run with `&quot;enable_delta_sync&quot;: false`
* Push replications will not use Delta Sync when pushing to a pre-2.8 target +
**Default** : `false`|boolean
|**max_backoff_time** +
__optional__|The *max_backoff_time*property specifies the time-period (in minutes) during which Sync Gateway will attempt to reconnect lost or unreachable _remote_ targets.

On disconnection, Sync Gateway will do an exponential backoff up to the specified value, after which it will attempt to reconnect indefinitely every _max_backoff_time_ minutes.

If a zero value is specified, then Sync Gateway will do an exponential backoff up to an interval of five minutes before stopping the replication.

NOTE – this value defaults to five minutes for replications created prior to version 2.8.|integer
|**initial_state** +
__optional__|*About*

The optional `initial_state` property is used to specify that the replication must be launched in 'Stopped' mode

*Behavior*

All replications are configured to start on Sync Gateway launch. So, if omitted, the state defaults to 'Running'.

**Constraints*

Replications created prior to version 2.8 will all default to a state of 'Running'. +
**Default** : `"Running"`|string
|**continuous** +
__optional__|*About*

The `continuous` property specifies whether this replication will run in continuous mode.

*Behavior*

* `continuous=true`– In continuous mode, changes are immediately synced in accordance with the replication definition.
* `continuous=false`– Detected changes are synced in accordance with the replication definition. The replication ceases once all revisions are processed.

*Constraints*

* Optional for stops and removes +
**Default** : `false`|boolean
|**filter** +
__optional__|*About*

Use the optional `filter`property to defines the function to be used to filter documents.

*Options*

A common value used when replicating from Sync Gateway is `sync_gateway/bychannel`. This option limits the pull replication to a specific set of channels. You can specify the required channels using `query_params`.

*Behavior*

Works in conjunction with `query_params` to control the documents processed by the replication.

*Example*

----
"filter":"sync_gateway/bychannel"
----

*Constraints*

OPTIONAL for stops and removes (even if defined during creation)|string
|**query_params** +
__optional__|*About*

The `query_params` property defines a set of key/value pairs used in the query string of the replication.

*Behavior*

This property works in conjunction with `filters` and `channels` to provide routing.

*Using*

You can use `query_params`' _channels_ function to _pull_ from a specific set of `channels`.
To do so, you would also need to set the `filter` to `sync_gateway/bychannels`.

*Example*

[source,json]
----
  "filter":"sync_gateway/bychannel",
  "query_params": {
    "channels":["channel.user1"]
  },
----

*Constraints*

OPTIONAL for stops and removes (even if defined during creation)|< string > array
|**cancel** +
__optional__|*About*

Use this parameter on,y when you want to want to cancel an existing active replication.

*Constraints*

* This parameter is *NOT* available in configured replications; only those initialized using the Admin REST API.
* *NOTE* that the body of the request must be the same as the replication's replication definition for the cancellation request to be honoured.
For example, if you requested continuous replication, the cancellation request must also contain the continuous field. +
**Default** : `false`|boolean
|**adhoc** +
__optional__|*About*

Use the Admin REST API's `adhoc` parameter to specify that a replication is ad hoc rather than persistent.

*Behavior*

Ad hoc replications behave the same as normal replications, but they are automatically removed when their status changes to stopped.
This will usually be on completion, but may also be as a result of user action.

*Constraints*

This parameter is *NOT* available to configured replications; only those initialized using the Admin REST API. +
**Default** : `false`|boolean
|**batch_size** +
__optional__|*About*

Use the optional `batch_size` property to specify the number of changes to be included in a single batch during replication.|integer
|**perf_tuning_params** +
__optional__|The perf_tuning_params are not available in this release.

NOTE – This property replaces the 'changes_feed_limit' at version 2.8|< string > array
|===



// end::content[]



