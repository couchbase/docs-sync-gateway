
[[_paths]]
== Resources

:page-partials:
// == Document begin hook

This resources section groups together the available API operations under functional categories.

include::_resources_toc.adoc[]



[[_attachment_resource]]
=== Attachment
Work with attachments


[[_getattachment]]
==== Get Specific Attachment
....
GET /{db}/{doc}/{attachment}
....


===== Description
This request retrieves a file attachment associated with the document.
The raw data of the associated attachment is returned (just as if you were accessing a static file).
The Content-Type response header is the same content type set when the document attachment was added to the database.

To remove an attachment from a document, simply update the `_attachments` dictionary of the document in the PUT `/{db}/{id}` request.
From then on, the attachment will not be replicated but will still reside in the Couchbase Server bucket (see open ticket https://github.com/couchbase/sync_gateway/issues/1648[#1648]).


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**attachment** +
__required__|Attachment name. This value must be URL encoded. For example, if the attachment name is `blob_/avatar`, the path component passed to the URL should be `blob_%2Favatar` (tested with https://www.urlencoder.org/[URLEncoder]).|string
|**Path**|**db** +
__required__|Database name|string
|**Path**|**doc** +
__required__|Document ID|string
|**Query**|**rev** +
__optional__|Revision identifier of the parent revision the new one should replace. (Not used when creating a new document.)|string
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|The message body contains the attachment, in the format specified in the Content-Type header.|string (binary)
|**304**|Not Modified, the attachment wasn't modified if ETag equals the If-None-Match header|No Content
|**404**|Not Found, the specified database, document or attachment was not found.|No Content
|===


[[_updateattachment]]
==== Create or Update Specific Attachment
....
PUT /{db}/{doc}/{attachment}
....


===== Description
This request adds or updates the supplied request content as an attachment to the specified document, the maximum content size of an attachment is 20MB.
The attachment name must be a URL-encoded string (the file name).
You must also supply either the rev query parameter or the If-Match HTTP header for validation, and the Content-Type headers (to set the attachment content type).

When uploading an attachment using an existing attachment name, the corresponding stored content of the database will be updated. Because you must supply the revision information to add an attachment to the document, this serves as validation to update the existing attachment.

Uploading an attachment updates the corresponding document revision.
Revisions are tracked for the parent document, not individual attachments.

To remove an attachment from a document, simply update the `_attachments` dictionary of the document in the PUT `/{db}/{id}` request.
From then on, the attachment will not be replicated but will still reside in the Couchbase Server bucket (see open ticket https://github.com/couchbase/sync_gateway/issues/1648[#1648]).


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Header**|**Content-Type** +
__optional__|Attachment Content-Type|string
|**Path**|**attachment** +
__required__|Attachment name. This value must be URL encoded. For example, if the attachment name is `blob_/avatar`, the path component passed to the URL should be `blob_%2Favatar` (tested with https://www.urlencoder.org/[URLEncoder]).|string
|**Path**|**db** +
__required__|Database name|string
|**Path**|**doc** +
__required__|Document ID|string
|**Query**|**rev** +
__optional__|Revision identifier of the parent revision the new one should replace. (Not used when creating a new document.)|string
|**Body**|**body** +
__optional__|The request body|string (binary)
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|Operation completed successfully|<<_success,Success>>
|**409**|Conflict, the document revision wasn't specified or it's not the latest.|No Content
|===


[[_authentication_resource]]
=== Authentication
Work with authentication


[[_authenticationviafacebook]]
==== Get Facebook Authenticated Session
....
POST /{db}/_facebook
....


===== Description
Sync Gateway allows users to authenticate using a Facebook account.

Your application is responsible for generating a Facebook token; this generally needs to be done by running the Facebook login flow inside a web-view and capturing the generated token.
This endpoint can be used to check the validity of the access token.
To allow Facebook Login with Sync Gateway, it must be explicitly enabled in the Sync Gateway configuration file by setting the link:config-properties.html#facebook-register[facebook.register] property to `true`.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|**Body**|**body** +
__optional__|Request body|<<_authenticationviafacebook_body,body>>
|===

[[_authenticationviafacebook_body]]
**body**

[options="header", cols=".^3,.^11,.^4"]
|===
|Name|Description|Schema
|**access_token** +
__optional__|The access token for the user to authenticate|string
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|Session successfully created. The Set-Cookie response header contains the session credentials.|<<_session,Session>>
|**401**|Facebook verification server status <Facebook status code>|No Content
|**502**|Invalid response from Facebook verifier|No Content
|===


[[_authenticationviagoogle]]
==== Get Google Authenticated Session
....
POST /{db}/_google
....


===== Description
Sync Gateway allows users to authenticate using a Google account.

Your application is responsible for generating a Google token; this generally needs to be done by running the Google login flow inside a web-view and capturing the generated token.
This endpoint can be used to check the validity of the access token.
To allow Google Login with Sync Gateway, it must be explicitly enabled in the Sync Gateway configuration file by setting the link:config-properties.html#google-register[google.register] property to `true` and setting the link:config-properties.html#google-app_client_id[google.app_client_id] property with a Google app client ID.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|**Body**|**body** +
__optional__|Request body|<<_authenticationviagoogle_body,body>>
|===

[[_authenticationviagoogle_body]]
**body**

[options="header", cols=".^3,.^11,.^4"]
|===
|Name|Description|Schema
|**id_token** +
__optional__|The access token for the user to authenticate|string
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|Session successfully created. The Set-Cookie response header contains the session credentials.|<<_session,Session>>
|**401**|Returns the Google response's ErrorDescription|No Content
|**502**|Invalid response from Google token verifier|No Content
|===


[[_getopenid]]
==== OpenID Connect Authentication.
....
GET /{db}/_oidc
....


===== Description
Called by clients to initiate the OIDC Authorization Code flow.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|**Query**|**offline** +
__optional__|When true, requests a refresh token from the OP. Sets access_type=offline and prompt=consent on the redirect to the OP. Secure clients should set offline=true and persist the returned refresh token to secure storage.|boolean
|**Query**|**provider** +
__optional__|OpenId Connect provider to be used for authentication, from the list of providers defined in the Sync Gateway Config. If not specified, will attempt to authenticate using the default provider.|string
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**302**|Redirect to the requested OpenID Connect provider for authentication. Redirect link is returned in the Location header.|No Content
|**400**|Bad request. Reason is returned as "OpenID Connect not configured for database default". If a provider was specified in the request, that provider was not defined in the Sync Gateway config. If no provider was specified, OpenID Connect is not configured in the Sync Gateway config.|No Content
|**500**|Server Error. Sync Gateway is unable to connect and validate the OpenID Connect provider requested.|No Content
|===


[[_getopenidauthcallback]]
==== Get OIDC Callback.
....
GET /{db}/_oidc_callback
....


===== Description
Sync Gateway callback URL that clients are redirected to by the OpenID Connect provider.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|**Query**|**code** +
__required__|OpenID Connect Authorization code.|string
|**Query**|**provider** +
__optional__|OpenId Connect provider to be used for authentication, from the list of providers defined in the Sync Gateway Config. If not specified, will attempt to authenticate using the default provider.|string
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|Successful OpenID Connect authentication.|<<_getopenidauthcallback_response_200,Response 200>>
|**400**|Bad request.|No Content
|**401**|Authentication failed. Reason returned in the response body.|No Content
|===

[[_getopenidauthcallback_response_200]]
**Response 200**

[options="header", cols=".^3,.^11,.^4"]
|===
|Name|Description|Schema
|**access_token** +
__optional__|OpenID Connect access token|string
|**expires_in** +
__optional__|TTL for id_token|number
|**id_token** +
__optional__|OpenID Connect ID token|string
|**name** +
__optional__|Sync Gateway username|string
|**refresh_token** +
__optional__|OpenID Connect refresh token|string
|**session_id** +
__optional__|Sync Gateway session token|string
|**token_type** +
__optional__|OpenID Connect token type|string
|===


[[_getopenidauth]]
==== Get OIDC Authentication.
....
GET /{db}/_oidc_challenge
....


===== Description
Called by clients to initiate the OIDC Authorization Code flow.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|**Query**|**offline** +
__optional__|When true, requests a refresh token from the OP.
Sets access_type=offline and prompt=consent on the redirect to the OP.
Secure clients should set offline=true and persist the returned refresh token to secure storage.|boolean
|**Query**|**provider** +
__optional__|OpenId Connect provider to be used for authentication, from the list of providers defined in the Sync Gateway Config.
If not specified, will attempt to authenticate using the default provider.|string
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**302**|Redirect to the requested OpenID Connect provider for authentication. Redirect link is returned in the Location header.|No Content
|**400**|Bad request. Reason is returned as "OpenID Connect not configured for database default". If a provider was specified in the request, that provider was not defined in the Sync Gateway config. If no provider was specified, OpenID Connect is not configured in the Sync Gateway config.|No Content
|**500**|Server Error. Sync Gateway is unable to connect and validate the OpenID Connect provider requested.|No Content
|===


[[_getopenidrefreshtoken]]
==== Get OIDC Refresh.
....
GET /{db}/_oidc_refresh
....


===== Description
Used to obtain a new OpenID Connect ID token based on the provided refresh token.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|**Query**|**provider** +
__optional__|OpenId Connect provider to be used for authentication, from the list of providers defined in the Sync Gateway Config. If not specified, will attempt to authenticate using the default provider.|string
|**Query**|**refresh_token** +
__required__|OpenID Connect refresh token.|string
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|Successful OpenID Connect authentication.|<<_getopenidrefreshtoken_response_200,Response 200>>
|**400**|Bad request.|No Content
|**401**|Authentication failed. Unable to refresh token.|No Content
|===

[[_getopenidrefreshtoken_response_200]]
**Response 200**

[options="header", cols=".^3,.^11,.^4"]
|===
|Name|Description|Schema
|**access_token** +
__optional__|OpenID Connect access token|string
|**expires_in** +
__optional__|TTL for id_token|number
|**id_token** +
__optional__|OpenID Connect ID token|string
|**name** +
__optional__|Sync Gateway username|string
|**session_id** +
__optional__|Sync Gateway session token|string
|**token_type** +
__optional__|OpenID Connect token type|string
|===


[[_database_resource]]
=== Database
Work with databases


[[_getdatabaseinfo]]
==== Get Database Data
....
GET /{db}/
....


===== Description
This request retrieves information about the database.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|Request completed successfully.|<<_database,Database>>
|**401**|Unauthorized. Login required.|No Content
|**404**|Not Found. Requested database not found.|No Content
|===


[[_getalldocswithparametersinbody]]
==== Get All Specified Documents
....
POST /{db}/_all_docs
....


===== Description
This request retrieves specified documents from the database.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4,.^2"]
|===
|Type|Name|Description|Schema|Default
|**Path**|**db** +
__required__|Database name|string|
|**Query**|**access** +
__optional__|Indicates whether to include in the response a list of what access this document grants (i.e. which users it allows to access which channels.) This option may only be used from the admin port.|boolean|`"false"`
|**Query**|**channels** +
__optional__|Indicates whether to include in the response a channels property containing an array of channels this document is assigned to. (Channels not accessible by the user making the request will not be listed.)|boolean|`"false"`
|**Query**|**include_docs** +
__optional__|Default is false. Indicates whether to include the associated document with each result. If there are conflicts, only the winning revision is returned.|boolean|`"false"`
|**Query**|**revs** +
__optional__|Default is false. Indicates whether to include a _revisions property for each document in the response, which contains a revision history of the document. The length of the returned revision tree can be specified with the `revs_limit` querystring parameter.|boolean|`"false"`
|**Query**|**update_seq** +
__optional__|Default is false. Indicates whether to include the update_seq (document sequence ID) property in the response.|boolean|`"false"`
|**Body**|**body** +
__optional__|Request body|<<_alldocs,AllDocs>>|
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|Query results|<<_queryresult,QueryResult>>
|===


[[_getalldocs]]
==== Get All Docs
....
GET /{db}/_all_docs
....


===== Description
This request returns a built-in view of all the documents in the database.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4,.^2"]
|===
|Type|Name|Description|Schema|Default
|**Path**|**db** +
__required__|Database name|string|
|**Query**|**access** +
__optional__|Indicates whether to include in the response a list of what access this document grants (i.e. which users it allows to access which channels.) This option may only be used from the admin port.|boolean|`"false"`
|**Query**|**channels** +
__optional__|Indicates whether to include in the response a channels property containing an array of channels this document is assigned to. (Channels not accessible by the user making the request will not be listed.)|boolean|`"false"`
|**Query**|**endkey** +
__optional__|If this parameter is provided, stop returning records when the specified key is reached.|string|
|**Query**|**include_docs** +
__optional__|Default is false. Indicates whether to include the associated document with each result. If there are conflicts, only the winning revision is returned.|boolean|`"false"`
|**Query**|**keys** +
__optional__|Specify a list of document IDs.|< string > array|
|**Query**|**limit** +
__optional__|Limits the number of result rows to the specified value. Using a value of 0 has the same effect as the value 1.|integer|
|**Query**|**revs** +
__optional__|Default is false. Indicates whether to include a _revisions property for each document in the response, which contains a revision history of the document. The length of the returned revision tree can be specified with the `revs_limit` querystring parameter.|boolean|`"false"`
|**Query**|**startkey** +
__optional__|Returns records starting with the specified key.|string|
|**Query**|**update_seq** +
__optional__|Default is false. Indicates whether to include the update_seq (document sequence ID) property in the response.|boolean|`"false"`
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|Query results|<<_queryresult,QueryResult>>
|===


[[_updatedocsinbulk]]
==== Create, Update or Delete Bulk docs
....
POST /{db}/_bulk_docs
....


===== Description
This request enables you to add, update, or delete multiple documents to a database in a single request. To add new documents, you can either specify the ID (`_id`) or let the software create an ID. To update existing documents, you must provide the document ID, revision identifier (`_rev`), and new document values. To delete existing documents you must provide the document ID, revision identifier, and the deletion flag (`_deleted`).

The JSON returned by the `_bulk_docs` operation consists of an array of JSON structures, one for each document in the original submission. The returned JSON structure should be examined to ensure that all of the documents submitted in the original request were successfully added to the database.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|**Body**|**BulkDocsBody** +
__optional__|The request body|<<_updatedocsinbulk_bulkdocsbody,BulkDocsBody>>
|===

[[_updatedocsinbulk_bulkdocsbody]]
**BulkDocsBody**

[options="header", cols=".^3,.^11,.^4"]
|===
|Name|Description|Schema
|**docs** +
__optional__|List containing new or updated documents. Each object in the array can contain the following properties _id, _rev, _deleted, and values for new and updated documents.|< <<_document,Document>> > array
|**new_edits** +
__optional__|Indicates whether to assign new revision identifiers to new edits. +
**Default** : `true`|boolean
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**201**|Documents have been created or updated. The response object is an array with the status for each document submitted in the original request.|< <<_updatedocsinbulk_response_201,Response 201>> > array
|**409**|The operation failed with a forbidden error. Probably because the document already exists in the database but a revision number wasn't specified.|<<_forbidden,Forbidden>>
|===

[[_updatedocsinbulk_response_201]]
**Response 201**

[options="header", cols=".^3,.^11,.^4"]
|===
|Name|Description|Schema
|**id** +
__optional__|Design document identifier|string
|**rev** +
__optional__|Revision identifier|string
|===


[[_getdocsinbulk]]
==== Get Bulk Documents
....
POST /{db}/_bulk_get
....


===== Description
This request returns any number of documents, as individual bodies in a MIME multipart response.

Each enclosed body contains one requested document.
The bodies appear in the same order as in the request, but can also be identified by their X-Doc-ID and X-Rev-ID headers.
A body for a document with no attachments will have content type application/json and contain the document itself.
A body for a document that has attachments will be written as a nested multipart/related body.
Its first part will be the document's JSON, and the subsequent parts will be the attachments (each identified by a Content-Disposition header giving its attachment name.)


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4,.^2"]
|===
|Type|Name|Description|Schema|Default
|**Path**|**db** +
__required__|Database name|string|
|**Query**|**attachments** +
__optional__|Default is false. Include attachment bodies in response.|boolean|`"false"`
|**Query**|**revs** +
__optional__|Default is false. Indicates whether to include a _revisions property for each document in the response, which contains a revision history of the document. The length of the returned revision tree can be specified with the `revs_limit` querystring parameter.|boolean|`"false"`
|**Query**|**revs_limit** +
__optional__|The number of revisions to include in the response from the document history. This parameter is only honoured if the `revs=true` querystring parameter is also sent in the request. If `revs=true` is specified and `revs_limit` isn't, the full revision history is returned.|integer|
|**Body**|**BulkGetBody** +
__optional__|List of documents being requested. Each array element is an object that must contain an id property giving the document ID. It may contain a rev property if a specific revision is desired. It may contain an atts_since property (as in a single-document GET) to limit which attachments are sent.|<<_getdocsinbulk_bulkgetbody,BulkGetBody>>|
|===

[[_getdocsinbulk_bulkgetbody]]
**BulkGetBody**

[options="header", cols=".^3,.^4"]
|===
|Name|Schema
|**docs** +
__optional__|< <<_db_bulk_get_post_docs,docs>> > array
|===

[[_db_bulk_get_post_docs]]
**docs**

[options="header", cols=".^3,.^11,.^4"]
|===
|Name|Description|Schema
|**id** +
__optional__|Document ID.|string
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|Request completed successfully|No Content
|**301**|Request failed with a forbidden error. This usually happens because the user requesting that document doesn't have access to it. Access to documents is granted to users through channels.|<<_getdocsinbulk_response_301,Response 301>>
|===

[[_getdocsinbulk_response_301]]
**Response 301**

[options="header", cols=".^3,.^11,.^4"]
|===
|Name|Description|Schema
|**_id** +
__optional__|The document ID that was requested|string
|**_removed** +
__optional__|**Default** : `true`|boolean
|**_rev** +
__optional__|The revision number that was requested|string
|===


===== Produces

* `multipart/mixed`


===== Example HTTP response

====== Response 200
[source,json]
----
{
  "multipart/mixed (document found)" : "--1cba224ff2aa106566e3ab65de9c861c24558ba368f8cd7f6fcde53b88f4\nContent-Type: application/json\n\n{\"_id\":\"doc123\",\"_rev\":\"1-c543d6514c609f65180f94af247aaffe\",\"hello\":\"world!\"}\n--1cba224ff2aa106566e3ab65de9c861c24558ba368f8cd7f6fcde53b88f4\n",
  "multipart/mixed (document not found)" : "--1cba224ff2aa106566e3ab65de9c861c24558ba368f8cd7f6fcde53b88f4\nContent-Type: application/json; error=\"true\"\n\n{\"error\":\"not_found\",\"id\":\"doc1234\",\"reason\":\"missing\",\"status\":404}\n--1cba224ff2aa106566e3ab65de9c861c24558ba368f8cd7f6fcde53b88f4\n"
}
----


[[_getchangeswithparametersinbody]]
==== Get Changes Feed (body parameters)
....
POST /{db}/_changes
....


===== Description
Same as the GET /_changes request except the parameters are in the JSON body.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|**Body**|**ChangesBody** +
__optional__|The request body|<<_getchangeswithparametersinbody_changesbody,ChangesBody>>
|===

[[_getchangeswithparametersinbody_changesbody]]
**ChangesBody**

[options="header", cols=".^3,.^11,.^4"]
|===
|Name|Description|Schema
|**active_only** +
__optional__|Default is false. When true, the changes response doesn't include either deleted documents, or notification for documents that the user no longer has access to. +
**Default** : `false`|boolean
|**channels** +
__optional__|A comma-separated list of channel names. The response will be filtered to only documents in these channels. (This parameter must be used with the sync_gateway/bychannel filter parameter; see below.)|string
|**doc_ids** +
__optional__|A list of document IDs as a valid JSON array. The response will be filtered to only documents with these IDs. (This parameter must be used with the _doc_ids filter parameter; see below.)|< string > array
|**feed** +
__optional__|Default is 'normal'. Specifies type of change feed. Valid values are normal, continuous, longpoll, websocket. +
**Default** : `"normal"`|string
|**filter** +
__optional__|Indicates that the returned documents should be filtered. The valid values are sync_gateway/bychannel and _doc_ids.|string
|**heartbeat** +
__optional__|The `heartbeat` defines the interval (in milliseconds) at which an empty line (CRLF) is written to the response. It helps prevent Sync Gateway from deciding the socket is idle and closing it.

The `heartbeat` value overrides any `timeout` value, to keep the feed alive indefinitely.

Setting `heartbeat=0` results in no heartbeat.

*Default:* 0, which is no heartbeat

*Constraints:*

* Applies ONLY where `feed=longpoll` or `feed=continuous`

* Minimum: 25000 (25 seconds)

* Maximum: None – unless you define one in your configuration file using `MaxHeartbeat`|integer
|**include_docs** +
__optional__|Default is false. Indicates whether to include the associated document with each result. If there are conflicts, only the winning revision is returned. +
**Default** : `false`|boolean
|**limit** +
__optional__|Limits the number of result rows to the specified value. Using a value of 0 has the same effect as the value 1.|integer
|**since** +
__optional__|Starts the results from the change immediately after the given sequence ID. Sequence IDs should be considered opaque; they come from the last_seq property of a prior response.|object
|**style** +
__optional__|Default is 'main_only'. Number of revisions to return in the changes array. The only possible value is all_docs and it returns all leaf revisions including conflicts and deleted former conflicts. +
**Default** : `"main_only"`|string
|**timeout** +
__optional__|The `timeout` value defines the maximum period (in milliseconds) to wait for a change, before sending a response. This wait applies even when there are no results.

Setting `timeout=0` results in no timeout.

*Default:* 300000 (5 minutes/300 seconds)

*Constraints:*

* Applies ONLY where `feed=longpoll` or `feed=continuous`

* Minimum: 0, no timeout

* Maximum: 1500000 (15 minutes)|integer
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|Request completed successfully|<<_changes,Changes>>
|===


[[_getchanges]]
==== Get Changes Feed (query parameters)
....
GET /{db}/_changes
....


===== Description
This request retrieves a sorted list of changes made to documents in the database, in time order of application.

Each document appears at most once, ordered by its most recent change, regardless of how many times it's been changed.
This request can be used to listen for update and modifications to the database for post processing or synchronization.
A continuously connected changes feed is a reasonable approach for generating a real-time log for most applications.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4,.^2"]
|===
|Type|Name|Description|Schema|Default
|**Path**|**db** +
__required__|Database name|string|
|**Query**|**active_only** +
__optional__|Default is false. When true, the changes response doesn't include either deleted documents, or notification for documents that the user no longer has access to.|boolean|`"false"`
|**Query**|**channels** +
__optional__|A comma-separated list of channel names. The response will be filtered to only documents in these channels. (This parameter must be used with the sync_gateway/bychannel filter parameter; see below.)|string|
|**Query**|**doc_ids** +
__optional__|A list of document IDs as a valid JSON array. The response will be filtered to only documents with these IDs. This parameter must be used with the `filter=_doc_ids` and `feed=normal` parameters.|< string > array|
|**Query**|**feed** +
__optional__|Default is 'normal'. Specifies type of change feed. Valid values are normal, continuous, longpoll, websocket.|string|`"normal"`
|**Query**|**filter** +
__optional__|Indicates that the reported documents should be filtered. The valid values are sync_gateway/bychannel and _doc_ids.|string|
|**Query**|**heartbeat** +
__optional__|The `heartbeat` defines the interval (in milliseconds) at which an empty line (CRLF) is written to the response. It helps prevent Sync Gateway from deciding the socket is idle and closing it.

The `heartbeat` value overrides any `timeout` value, to keep the feed alive indefinitely.

Setting `heartbeat=0` results in no heartbeat.

*Default:* 0, which is no heartbeat

*Constraints:*

* Applies ONLY where `feed=longpoll` or `feed=continuous`.

* Minimum: 25000 (25 seconds)

* Maximum: None – unless you define one in your configuration file using `MaxHeartbeat`|integer|`0`
|**Query**|**include_docs** +
__optional__|Default is false. Indicates whether to include the associated document with each result. If there are conflicts, only the winning revision is returned.|boolean|`"false"`
|**Query**|**limit** +
__optional__|Limits the number of result rows to the specified value. Using a value of 0 has the same effect as the value 1.|integer|
|**Query**|**since** +
__optional__|Starts the results from the change immediately after the given sequence ID. Sequence IDs should be considered opaque; they come from the last_seq property of a prior response.|string|
|**Query**|**style** +
__optional__|Default is 'main_only'. Number of revisions to return in the changes array. main_only returns the current winning revision, all_docs returns all leaf revisions including conflicts and deleted former conflicts.|string|`"main_only"`
|**Query**|**timeout** +
__optional__|The `timeout` value defines the maximum period (in milliseconds) to wait for a change, before sending a response. This wait applies even when there are no results.

Setting `timeout=0` results in no timeout.

*Default:* 300000 (5 minutes/300 seconds)

*Constraints:*

* Applies ONLY where `feed=longpoll` or `feed=continuous`.

* Minimum: 0, no timeout

* Maximum: 1500000 (15 minutes)|integer|`300000`
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|Request completed successfully|<<_changes,Changes>>
|===


[[_getrevisionids]]
==== Get Revision ID Diff
....
POST /{db}/_revs_diff
....


===== Description
Given a set of document/revision IDs, returns the subset of those that do not correspond to revisions stored in the database.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|**Body**|**body** +
__optional__|Request body|< string, < string > array > map
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|The request was successful|< string, <<_getrevisionids_response_200,Response 200>> > map
|===

[[_getrevisionids_response_200]]
**Response 200**

[options="header", cols=".^3,.^11,.^4"]
|===
|Name|Description|Schema
|**missing** +
__optional__|A list of revision IDs for that document (the ones that are not stored in the database).|< string > array
|===


[[_document_resource]]
=== Document
Work with documents


[[_adddocument]]
==== Create New Document
....
POST /{db}/
....


===== Description
This request creates a new document in the specified database.

You can either specify the document ID by including the _id in the request message body (the value must be a string), or let the software generate an ID.

The maximum size allowed for a document is 20MB.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|**Body**|**body** +
__optional__|The document body|object
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**201**|The document was written successfully|<<_success,Success>>
|===


[[_getdocument]]
==== Get Specific Document
....
GET /{db}/{doc}
....


===== Description
This request retrieves a document from a database.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4,.^2"]
|===
|Type|Name|Description|Schema|Default
|**Path**|**db** +
__required__|Database name|string|
|**Path**|**doc** +
__required__|Document ID|string|
|**Query**|**attachments** +
__optional__|Default is false. Include attachment bodies in response.|boolean|`"false"`
|**Query**|**atts_since** +
__optional__|Include attachments only since specified revisions. Does not include attachments for specified revisions.|< string > array|
|**Query**|**open_revs** +
__optional__|Option to fetch specified revisions of the document. The value can be `all` to fetch all leaf revisions or an array of revision numbers (i.e. open_revs=["rev1", "rev2"]). Only link:glossary.html[leaf revision] bodies that haven't been pruned are guaranteed to be returned.

If this option is specified the response will be in multipart format. Use the `Accept: application/json` request header to get the result as a JSON object.|< string > array|
|**Query**|**rev** +
__optional__|Revision identifier of the revision to get. By default, Sync Gateway returns the current revision. This parameter is generally only needed for conflict resolution. For example where the app might need to retrieve a conflicting leaf revision that isn't the current revision.|string|
|**Query**|**revs** +
__optional__|Default is false. Indicates whether to include a _revisions property for each document in the response, which contains a revision history of the document. The length of the returned revision tree can be specified with the `revs_limit` querystring parameter.|boolean|`"false"`
|**Query**|**show_exp** +
__optional__|Whether to show the _exp property in the response.|boolean|`"false"`
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|The message body contains the following objects in a JSON document.|object
|===


[[_addorupdatedocument]]
==== Create or Update Specific Document
....
PUT /{db}/{doc}
....


===== Description
This request creates a new document or creates a new revision of an existing document.
It enables you to specify the identifier for a new document rather than letting the software create an identifier.

If you want to create a new document and let the software create an identifier, use the POST /db request.

If the document specified by doc does not exist, a new document is created and assigned the identifier specified in doc.
If the document already exists, the document is updated with the JSON document in the message body and given a new revision.
The maximum size allowed for a document is 20MB.

Since Sync Gateway 1.3, an expiry property (`_exp`) can also be specified to purge the document after a given time.
If *convergence* is enabled (introduced in Sync Gateway 1.5), the behavior of the expiry feature changes in the following way: when the expiry value is reached, instead of getting purged, the *active* revision of the document is tombstoned.
If there is another non-tombstoned revision for this document (i.e a conflict) it will become the active revision.
The tombstoned revision will be purged when the server's metadata purge interval is reached.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4,.^2"]
|===
|Type|Name|Description|Schema|Default
|**Path**|**db** +
__required__|Database name|string|
|**Path**|**doc** +
__required__|Document ID|string|
|**Query**|**new_edits** +
__optional__|Default is true. Setting this to false indicates that the request body is an already-existing revision that should be directly inserted into the database, instead of a modification to apply to the current document. (This mode is used by the replicato.) This option must be used in conjunction with the `_revisions` property in the request body.|boolean|`"true"`
|**Query**|**rev** +
__required__|Revision identifier of the revision to update. It must be the last revision in the history.|string|
|**Body**|**Document** +
__optional__|Request body|<<_document,Document>>|
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|The response is a JSON document that contains the following objects|<<_success,Success>>
|===


[[_deletedocument]]
==== Delete Specific Document
....
DELETE /{db}/{doc}
....


===== Description
This request deletes a document from the database.

When a document is deleted, the revision number is updated so the database can track the deletion in synchronized copies.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|**Path**|**doc** +
__required__|Document ID|string
|**Query**|**rev** +
__required__|Revision identifier of the revision to delete. It must be the identifier of the latest revision in the history.|string
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|Document successfully removed|<<_success,Success>>
|===


[[_document_local_resource]]
=== Document (local)
Work with local documents


[[_getlocaldoc]]
==== Get Specific Local Document
....
GET /{db}/_local/{local_doc}
....


===== Description
This request retrieves a local document.

Local document IDs begin with _local/.
Local documents are not replicated or indexed, don't support attachments, and don't save revision histories.

In practice local documents mostly used by Couchbase Lite's replicator, as a place to store replication checkpoint data.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|**Path**|**local_doc** +
__required__|Local document IDs begin with _local/.|string
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|The message body contains the following objects in a JSON document.|<<_success,Success>>
|===


[[_addorupdatelocaldoc]]
==== Create or Update a Local Document
....
PUT /{db}/_local/{local_doc}
....


===== Description
This request creates or updates a local document.

Local document IDs begin with _local/.
Local documents are not replicated or indexed, don't support attachments, and don't save revision histories.

In practice they are almost only used by the client's replicator, as a place to store replication checkpoint data.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|**Path**|**local_doc** +
__required__|Local document IDs begin with _local/.|string
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**201**|Created|<<_success,Success>>
|===


[[_deletelocaldoc]]
==== Delete Specific Local Document
....
DELETE /{db}/_local/{local_doc}
....


===== Description
This request deletes a local document.

Local document IDs begin with _local/. Local documents are not replicated or indexed, don't support attachments, and don't save revision histories.
In practice they are almost only used by Couchbase Lite's replicator, as a place to store replication checkpoint data.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|**Path**|**local_doc** +
__required__|Local document IDs begin with _local/.|string
|**Query**|**batch** +
__optional__|Stores the document in batch mode. To use, set the value to ok.|string
|**Query**|**rev** +
__optional__|Revision identifier of the parent revision the new one should replace. (Not used when creating a new document.)|string
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|Document successfully removed|<<_success,Success>>
|===


[[_server_resource]]
=== Server
Work with the server


[[_getserverinfo]]
==== Get Server Data
....
GET /
....


===== Description
Returns meta-information about the server.


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|Meta-information about the server.|<<_serverdata_model,ServerData_model>>
|===


[[_session_resource]]
=== Session
Work with sessions


[[_addusersession]]
==== Create User Session
....
POST /{db}/_session
....


===== Description
If the credentials provided in the request body are valid, the session is created with an idle session timeout of 24 hours.

An idle session timeout in the context of Sync Gateway is defined as the following: if 10% or more of the current expiration time has elapsed when a subsequent request with that session id is processed, the session's expiry time is automatically updated to 24 hours from that time.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Path**|**db** +
__required__|Database name|string
|**Body**|**SessionBody** +
__optional__|The message body is a JSON document that contains the following objects.|<<_addusersession_sessionbody,SessionBody>>
|===

[[_addusersession_sessionbody]]
**SessionBody**

[options="header", cols=".^3,.^11,.^4"]
|===
|Name|Description|Schema
|**name** +
__optional__|Username of the user the session will be associated to.|string
|**password** +
__optional__|User password.|string
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|Session successfully created. The Set-Cookie response header contains the session credentials.|<<_session,Session>>
|===


[[_deleteusersession]]
==== Delete User Session
....
DELETE /{db}/_session
....


===== Description
This request deletes the session that currently authenticates the requests.


===== Parameters

[options="header", cols=".^2,.^3,.^9,.^4"]
|===
|Type|Name|Description|Schema
|**Header**|**cookie** +
__optional__|The cookie of the logged-in session.|string
|**Path**|**db** +
__required__|Database name|string
|===


===== Responses

[options="header", cols=".^2,.^14,.^4"]
|===
|HTTP Code|Description|Schema
|**200**|The session was successfully removed.|No Content
|===



